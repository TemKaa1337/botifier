#!/usr/bin/env php
<?php

use Temkaa\Botifier\Command\Console;
use Temkaa\Botifier\Command\Input;
use Temkaa\Botifier\DependencyInjection\Command\ConfigProvider;
use Temkaa\Botifier\Enum\Command\Argument;
use Temkaa\Container\Builder\ContainerBuilder;

require_once sprintf('%s/vendor/autoload.php', getcwd());

$arguments = array_shift($argv);

$input = new Input($arguments);
if (!$input->hasArgument(Argument::Token)) {
    echo sprintf('%s argument is required.', Argument::Token->value);
    exit(1);
}

putenv(sprintf('BOT_TOKEN=%s', $input->getArgument(Argument::Token)));

$container = ContainerBuilder::make()->add(new ConfigProvider())->build();

$signature = $arguments ? array_shift($arguments) : null;

/** @var Console $console */
$console = $container->get(Console::class);
$exitCode = $console->execute($signature, $input);

exit($exitCode);
